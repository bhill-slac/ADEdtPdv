#
# EPICS database for
# Allied Vision Technoligies GoldEye-008CL
#
# Protocol root must match db filename root
# i.e. avtGoldEye008.proto

record( seq, "$(P)$(R)EdtReConfigSeq" )
{
	field( DLY1, "0.0" ) field( DOL1, "1" ) field( LNK1, "$(P)$(R)GoldEyeAccessPrivilege" )
	field( DLY2, "0.2" ) field( DOL2, "1" ) field( LNK2, "$(P)$(R)Manufacturer_RBV" )
	field( DLY3, "0.2" ) field( DOL3, "1" ) field( LNK3, "$(P)$(R)Model_RBV" )
	field( DLY4, "0.2" ) field( DOL4, "1" ) field( LNK4, "$(P)$(R)FirmwareVersion_RBV" )
	field( DLY5, "0.2" ) field( DOL5, "1" ) field( LNK5, "$(P)$(R)SerialNumber_RBV" )
	field( DLY6, "0.2" ) field( DOL6, "1" ) field( LNK6, "$(P)$(R)GoldEyeModel_RBV" )
	field( DLY7, "0.2" ) field( DOL7, "1" ) field( LNK7, "$(P)$(R)GoldEyeManufacturer_RBV" )
#   field( TPRO, 1 )
#	field( FLNK, "$(P)$(R)EdtReConfigSeq2" )
}
record( seq, "$(P)$(R)EdtReConfigSeq2" )
{
#	field( FLNK, "$(P)$(R)EdtReConfigSeq3" )
}

record( stringin, "$(P)$(R)CamModel" )
{
	field( VAL,  "avtGoldEye008" )
	field( PINI, "YES" )
}

record( stringin, "$(P)$(R)CamModelScreen" )
{
	field( VAL,  "edtPdvScreens/avtGoldEye008.edl" )
	field( PINI, "YES" )
}

# Provide defaults for ADCore SizeX and SizeY
record( longout, "$(P)$(R)SizeX" )
{
	field( VAL, "324" )
}
record( longout, "$(P)$(R)SizeY" )
{
	field( VAL, "256" )
}

#
# AVT GoldEye Register Access PV's
#

# Need to set AccessPrivilege to 1 on startup for R/W control and image streaming
record( longout, "$(P)$(R)GoldEyeAccessPrivilege" )
{
	field( DOL,  "1" )
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x204) $(PORT).SER" )
	field( PINI, "YES" )
	field( FLNK, "$(P)$(R)GoldEyeAccessPrivilege_RBV" )
    field( SDIS, "$(SerialDisable)")
}
# Read at least one register every 3 seconds or camera clears AccessPrivilege
record( longin, "$(P)$(R)GoldEyeAccessPrivilege_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x204) $(PORT).SER" )
    field( SDIS, "$(SerialDisable)")
#	field( SCAN, "1 second" )
}

# Update fields for ADCore records that we get via GenCP
record( stringin, "$(P)$(R)Manufacturer_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetStr(64,0x4) $(PORT).SER" )
	field( SCAN, "Passive" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

# Update fields for ADCore records that we get via GenCP
record( stringin, "$(P)$(R)Model_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetStr(64,0x44) $(PORT).SER" )
	field( SCAN, "Passive" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

record( stringin, "$(P)$(R)GoldEyeModel_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetStr(64,0x44) $(PORT).SER" )
	field( SCAN, "Passive" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

# Update fields for ADCore records that we get via GenCP
record( stringin, "$(P)$(R)GoldEyeFirmwareVersion_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetStr(64,0xC4) $(PORT).SER" )
	field( SCAN, "Passive" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

# Update fields for ADCore records that we get via GenCP
record( stringin, "$(P)$(R)GoldEyeSerialNumber_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetStr(64,0x144) $(PORT).SER" )
	field( SCAN, "Passive" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

# Update fields for ADCore records that we get via GenCP
record( ai, "$(P)$(R)GoldEyeTemperature_RBV" )
{
	field( DESC, "Temperature of camera sensor" )
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetFloat32(0x24104) $(PORT).SER" )
	field( EGU,  "C" )
	field( PREC, "1" )
	field( PINI, "YES" )
#	field( SCAN, "1 second" )
    field( SDIS, "$(SerialDisable)")
}

record( ai, "$(P)$(R)GoldEyeTempMainBd_RBV" )
{
	field( DESC, "Temperature of main board" )
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetFloat32(0x24108) $(PORT).SER" )
	field( EGU,  "C" )
	field( PREC, "1" )
	field( PINI, "YES" )
#	field( SCAN, "1 second" )
    field( SDIS, "$(SerialDisable)")
}

record( ai, "$(P)$(R)GoldEyeTempSensorBd_RBV" )
{
	field( DESC, "Temperature of sensor board" )
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetFloat32(0x2410C) $(PORT).SER" )
	field( EGU,  "C" )
	field( PREC, "1" )
	field( PINI, "YES" )
#	field( SCAN, "1 second" )
    field( SDIS, "$(SerialDisable)")
}

# AcquireTime
record( ao, "$(P)$(R)EdtAcquireTime" )
{
	field( PREC, "5" )
	field( FLNK, "$(P)$(R)GoldEyeAcquireTime" )
}
record( calcout, "$(P)$(R)GoldEyeAcquireTime" )
{
	field( INPA, "$(P)$(R)EdtAcquireTime NPP MS" )
	field( CALC, "A*1e6" )
	field( EGU,  "us" )
	field( OUT,  "$(P)$(R)GoldEyeExposureValue NPP MS" )
	field( FLNK, "$(P)$(R)GoldEyeExposureValue" )
    field( SDIS, "$(SerialDisable)")
}
record( longout, "$(P)$(R)GoldEyeExposureValue" )
{
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x14110) $(PORT).SER" )
	field( EGU,  "us" )
	field( LOPR, "6" )
	field( HOPR, "0x6666666" )
	field( FLNK, "$(P)$(R)GoldEyeExposureValue_RBV" )
    field( SDIS, "$(SerialDisable)")
}

record( longin, "$(P)$(R)GoldEyeExposureValue_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x14110) $(PORT).SER" )
	field( EGU,  "us" )
	field( LOPR, "6" )
	field( HOPR, "0x6666666" )
	field( PINI, "YES" )
	field( FLNK, "$(P)$(R)GoldEyeAcquireTime_RBV" )
    field( SDIS, "$(SerialDisable)")
}
record( calcout, "$(P)$(R)GoldEyeAcquireTime_RBV" )
{
	field( INPA, "$(P)$(R)GoldEyeExposureValue_RBV NPP MS" )
	field( CALC, "A/1e6" )
	field( OUT,  "$(P)$(R)EdtAcquireTime_RBV NPP MS" )
	field( FLNK, "$(P)$(R)EdtAcquireTime_RBV" )
	field( EGU,  "sec" )
}

record( longout, "$(P)$(R)GoldEyeHeartbeatTimeout" )
{
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x1E8) $(PORT).SER" )
	field( EGU,  "ms" )
	field( FLNK, "$(P)$(R)GoldEyeHeartbeatTimeout_RBV" )
    field( SDIS, "$(SerialDisable)")
}

record( longin, "$(P)$(R)GoldEyeHeartbeatTimeout_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x1E8) $(PORT).SER" )
	field( EGU,  "ms" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

record( longout, "$(P)$(R)GoldEyeBinX" )
{
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x11108) $(PORT).SER" )
	field( EGU,  "px" )
	field( FLNK, "$(P)$(R)GoldEyeBinX_RBV" )
    field( SDIS, "$(SerialDisable)")
}

record( longin, "$(P)$(R)GoldEyeBinX_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x11108) $(PORT).SER" )
	field( EGU,  "ms" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

record( longout, "$(P)$(R)GoldEyeBinY" )
{
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x11128) $(PORT).SER" )
	field( EGU,  "px" )
	field( FLNK, "$(P)$(R)GoldEyeBinY_RBV" )
    field( SDIS, "$(SerialDisable)")
}

record( longin, "$(P)$(R)GoldEyeBinY_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x11128) $(PORT).SER" )
	field( EGU,  "ms" )
	field( PINI, "YES" )
    field( SDIS, "$(SerialDisable)")
}

# RegAcquisitionCommand
record( mbbo, "$(P)$(R)GoldEyeAcquire" )
{
	field( DOL,  "$(P)$(R)Acquire CPP MS" )
	field( OMSL, "closed_loop" )
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x130F4) $(PORT).SER" )
	field( ZRVL, "0" ) field( ZRST, "Stop" )
	field( ONVL, "1" ) field( ONST, "Start" )
	field( TWVL, "2" ) field( TWST, "Abort" )
    field( SDIS, "$(SerialDisable)")
}

record( mbbo, "$(P)$(R)GoldEyeFStartTrMode" )
{
	field( ZRVL, "0" ) field( ZRST, "FreeRun" )
	field( ONVL, "1" ) field( ONST, "Line1" )
	field( TWVL, "2" ) field( TWST, "Line2" )
	field( THVL, "3" ) field( THST, "Line3" )
	field( FRVL, "4" ) field( FRST, "Line4" )
	field( FVVL, "5" ) field( FVST, "CC1" )
	field( SXVL, "6" ) field( SXST, "CC2" )
	field( SVVL, "7" ) field( SVST, "CC3" )
	field( EIVL, "8" ) field( EIST, "CC4" )
	field( NIVL, "9" ) field( NIST, "FixedRate" )
	field( TEVL, "9" ) field( TEST, "Software" )
	field( FLNK, "$(P)$(R)GoldEyeFStartFullTrMode" )
}

# FrameStart TriggerSource
record( mbbo, "$(P)$(R)GoldEyeFStartTrSrc" )
{
	field( ZRVL, "0" ) field( ZRST, "FreeRun" )
	field( ONVL, "1" ) field( ONST, "Line1" )
	field( TWVL, "2" ) field( TWST, "Line2" )
	field( THVL, "3" ) field( THST, "Line3" )
	field( FRVL, "4" ) field( FRST, "Line4" )
	field( FVVL, "5" ) field( FVST, "CC1" )
	field( SXVL, "6" ) field( SXST, "CC2" )
	field( SVVL, "7" ) field( SVST, "CC3" )
	field( EIVL, "8" ) field( EIST, "CC4" )
	field( NIVL, "9" ) field( NIST, "FixedRate" )
	field( TEVL, "9" ) field( TEST, "Software" )
	field( FLNK, "$(P)$(R)GoldEyeFStartFullTrMode" )
}

# FrameStopTriggerMode combines several bit fields into one 32 bit register, RegFullTriggerMode
# There are 3 of these RegFullTriggerMode registers:
#	Addr		TriggerType			Name
#	0x13410		FrameStart			FStartFullTrMode - The trigger that starts each image
#	0x134D0		AcquisitionStart	AStartFullTrMode - The trigger that starts the acquisition process
#	0x13510		AcquisitionStop		AStopFullTrMode  - The trigger that stops  the acquisition process

# Bit numbering for GeniCam: MSB is 0, LSB is 31 for 32 bit register
# Bit(s)	Name
#	0		TriggerMode: Off/On
#	16-31	TriggerSource enum, valid when TriggerMode is On
#
record( calcout, "$(P)$(R)GoldEyeCalcFStartFullTrMode" )
{
	field( DESC, "FrameStart: Controls image start" )
	field( INPA, "$(P)$(R)GoldEyeTriggerMode   NPP MS" )
	field( INPB, "$(P)$(R)GoldEyeTriggerSource NPP MS" )
	field( CALC, "(B<<16)|(A&0xFFFF)" )
	field( OUT,  "$(P)$(R)GoldEyeFStartFullTrMode PP MS" )
}

record( longout, "$(P)$(R)GoldEyeFStartFullTrMode" )
{
	field( DTYP, "stream" )
	field( OUT,  "@avtGoldEye008.proto SetUint32(0x13410) $(PORT).SER" )
	field( FLNK, "$(P)$(R)GoldEyeFStartFullTrMode_RBV" )
    field( SDIS, "$(SerialDisable)")
}

record( longin, "$(P)$(R)GoldEyeFStartFullTrMode_RBV" )
{
	field( DTYP, "stream" )
	field( INP,  "@avtGoldEye008.proto GetUint32(0x13410) $(PORT).SER" )
    field( SDIS, "$(SerialDisable)")
}

# RegTriggerSourceInq is 32 bit register w/ bits for whether
# each trigger source type is selected
# There are 3 of these RegTriggerSourceInq registers:
#	Addr		TriggerType			GoldEyeValue	Name
#	0x13408		FrameStart			0x0000707		FStartTrSrcInq - The trigger that starts each image
#	0x134C8		AcquisitionStart	0x00001e6		AStartTrSrcInq - The trigger that starts the acquisition process
#	0x13508		AcquisitionStop 	0x00001e6		AStopTrSrcInq  - The trigger that starts the acquisition process
#
#	Bit		Name
#	21		Software
#	22		FixedRate
#	23		CC1
#
#	24		CC2
#	25		CC3
#	26		CC4
#	27		unused
#
#	28		unused
#	29		Ext Trig Line2
#	30		Ext Trig Line1
#	31		FreeRun

# TODO:
#	0x11108	RegBinningXValue: 1-8
#	0x11128	RegBinningYValue: 1-8
#	0x13104	RegAcquisitionMode: 1=Continuous, 2=SingleFrame, 3=MultiFrame via RegAcquisitionFrameCount
#	0x13108	RegAcquisitionFrameCount: Frame count for MultiFrame AcquisitionMode
#	0x13138	RegFixedIntervalValue
#	0x1341C	FrameStartRegTriggerDelay
#	0x13418	RegTriggerEvent, FStartTrActivation: RisingEdge/FallingEdge/AnyEdge,LevelHigh,LevelLow
#	0x13424	RegTriggeroverlap:	FStartTriggerOverlap: Ignore/ReTrig
#	0x1341C	RegTriggerDelay: us 
#	0x13160	RegSoftwareTrigger: Off/On
#
